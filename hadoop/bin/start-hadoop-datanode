#!/usr/bin/env bash

# Starts the Hadoop data node. Expects the name node host and the daemon flag
# as parameters
echo "run start-hadoop-datanode"
source /etc/bashrc

if [[ -z "${1}" ]]; then
  echo "Name node host not specified" >&2
  exit 1
fi

# Wait for the name node to be online
while ! nc -z $1 50070; do
  sleep 3;
done;

# Start HDFS data node
hadoop-daemon.sh start datanode

# Start YARN node manager
yarn-daemons.sh start nodemanager

# Start daemon if specified
if [[ "${2}" != 'daemon' ]]; then
  sleep infinity
fi

echo "run start-hadoop-datanode done"